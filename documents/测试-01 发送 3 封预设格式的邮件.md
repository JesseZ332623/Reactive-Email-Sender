# 测试-01 发送 3 封预设格式的邮件

```java
@Slf4j
@SpringBootTest
class ReactiveEmailSenderTest
{
    @Autowired
    private ReactiveEmailSender emailSender;

    private @NotNull Mono<EmailContent> verifyMail()
    {
        return
        EmailContent.fromVarify(
            "Peter-Griffin",
            "peter-griffin233@whitehouse.gov",
            8, Duration.ofMinutes(5)
        );
    }

    private @NotNull Mono<EmailContent> textMail()
    {
        return
        EmailContent.fromJustText(
            "peter-griffin233@whitehouse.gov",
            "Plain text mail",
            "Tragedy is the destruction of beautiful things."
        );
    }

    private @NotNull Mono<EmailContent>
    attachmentMail()
    {
        return
        Mono.using(
            () -> getClass().getResourceAsStream("/attachment/oiia-oiiaoiia.gif"),
            (resourceStream) -> {
                try
                {
                    byte[] bytes = resourceStream.readAllBytes();

                    return
                    EmailContent.formWithAttachment(
                        "Peter-Griffin", "peter-griffin233@whitehouse.gov",
                        "Sharing a funny GIF", "oiia-oiiaoiia",
                        "oiia-oiiaoiia.gif", bytes
                    );
                }
                catch (IOException exception)
                {
                    return
                    Mono.error(
                        new RuntimeException("Read attachment from class path failed...")
                    );
                }
            },
            (resourceStream) -> {
                try
                {
                    if (Objects.nonNull(resourceStream)) {
                        resourceStream.close();
                    }
                }
                catch (IOException exception) {
                    log.error("Close resource stream failed...");
                }
            }
        ).onErrorResume((e) ->
            Mono.error(new RuntimeException(e.getMessage(), e)
            )
        );
    }
    
    @Test 
    void sendEmailTest()
    {
        Mono.zip(verifyMail(), textMail(), attachmentMail())
            .flatMap((mails) ->
                Mono.when(
                    this.emailSender.sendEmail(mails.getT1()),
                    this.emailSender.sendEmail(mails.getT2()),
                    this.emailSender.sendEmail(mails.getT3())
                )
            ).block();
    }
}
```
